<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Self host email service"><title>Self Hosting An Email Server With iRedMail</title>
<link rel=canonical href=https://yuiofastora.github.io/p/self-hosting-an-email-server-with-iredmail/><link rel=stylesheet href=/scss/style.min.8e60baf4cd3fc55968717a6e39762f4d28ed7ef6007566b6c7970ad0fe907198.css><meta property='og:title' content="Self Hosting An Email Server With iRedMail"><meta property='og:description' content="Self host email service"><meta property='og:url' content='https://yuiofastora.github.io/p/self-hosting-an-email-server-with-iredmail/'><meta property='og:site_name' content="Yui's Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='docker'><meta property='article:tag' content='self host'><meta property='article:published_time' content='2023-01-26T19:00:47+08:00'><meta property='article:modified_time' content='2023-01-26T19:00:47+08:00'><meta name=twitter:title content="Self Hosting An Email Server With iRedMail"><meta name=twitter:description content="Self host email service"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hud80d60de99bfe81531b379b0441f05d9_43948_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>üç°</span></figure><div class=site-meta><h1 class=site-name><a href=/>Yui's Blog</a></h1><h2 class=site-description>@YuiOfAstora The way forward</h2></div></header><ol class=menu-social><li><a href=mailto:yuiofastora@outlook.com target=_blank title=Email rel=me><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-gmail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 20h3a1 1 0 001-1V5a1 1 0 00-1-1h-3v16z"/><path d="M5 20h3V4H5A1 1 0 004 5v14a1 1 0 001 1z"/><path d="M16 4l-4 4-4-4"/><path d="M4 6.5l8 7.5 8-7.5"/></svg></a></li><li><a href=https://t.me/YuiOfAstora target=_blank title=Telegram rel=me><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-telegram"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M15 10l-4 4 6 6 4-16-18 7 4 2 2 6 3-4"/></svg></a></li><li><a href=https://x.com/YuiOfAstora target=_blank title=X rel=me><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-x"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#requirements>Requirements</a></li><li><a href=#enable-googles-tcp-bbr>Enable Google‚Äôs TCP BBR</a></li><li><a href=#setting-up-hostname>Setting up hostname</a></li><li><a href=#install>Install</a></li><li><a href=#get-ssl-cert>Get SSL cert</a></li><li><a href=#setting-up-dns-records>Setting Up DNS Records</a><ol><li><a href=#setting-ptr>Setting PTR</a></li><li><a href=#setting-mx-record>Setting MX record</a></li><li><a href=#setting-spf-record>Setting SPF record</a></li><li><a href=#setting-dkim-records>Setting DKIM Records</a></li><li><a href=#setting-dmarc-records>Setting DMARC Records</a></li><li><a href=#check-status>Check Status</a></li></ol></li><li><a href=#access-email>Access EMail</a></li><li><a href=#test-spammyness-of-emails>Test Spammyness of Emails</a></li><li><a href=#fail2ban>Fail2ban</a></li><li><a href=#credits>Credits</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/guide/>Guide</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/self-hosting-an-email-server-with-iredmail/>Self Hosting An Email Server With iRedMail</a></h2><h3 class=article-subtitle>Self host email service</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 26, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><p>Self host email service</p><h2 id=requirements><a href=#requirements>#</a>
Requirements</h2><p>Ports should be open:</p><p><a class=link href=https://docs.iredmail.org/network.ports.html target=_blank rel=noopener>https://docs.iredmail.org/network.ports.html</a></p><p><strong>RAM >= 2 GB</strong></p><p><strong>2vcpus</strong></p><p>Using Ubuntu 20.04 LTS for this time</p><h2 id=enable-googles-tcp-bbr><a href=#enable-googles-tcp-bbr>#</a>
Enable Google‚Äôs TCP BBR</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>echo &#34;net.core.default_qdisc=fq&#34; &gt;&gt; /etc/sysctl.conf
</span></span><span class=line><span class=cl>echo &#34;net.ipv4.tcp_congestion_control=bbr&#34; &gt;&gt; /etc/sysctl.conf
</span></span><span class=line><span class=cl>sysctl -p
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Check whether bbr is enabled
</span></span><span class=line><span class=cl>sysctl net.ipv4.tcp_available_congestion_control
</span></span><span class=line><span class=cl>#output should be
</span></span><span class=line><span class=cl>net.ipv4.tcp_congestion_control = bbr
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Check whether bbr is started
</span></span><span class=line><span class=cl>lsmod | grep bbr
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># Output should be
</span></span><span class=line><span class=cl>tcp_bbr                20480  14
</span></span></code></pre></td></tr></table></div></div><h2 id=setting-up-hostname><a href=#setting-up-hostname>#</a>
Setting up hostname</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nano /etc/hosts
</span></span><span class=line><span class=cl>#add line
</span></span><span class=line><span class=cl>127.0.0.1 mail.mydomain.com mail
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>nano /etc/hostname
</span></span><span class=line><span class=cl>#Change to
</span></span><span class=line><span class=cl>mail
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo reboot
</span></span></code></pre></td></tr></table></div></div><p>Check hostname</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>hostname
</span></span><span class=line><span class=cl>#Output shoulde be mail
</span></span><span class=line><span class=cl>hostname -f
</span></span><span class=line><span class=cl>#Output should be mail.mydomain.com
</span></span></code></pre></td></tr></table></div></div><h2 id=install><a href=#install>#</a>
Install</h2><p>Download the latest version</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wget https://github.com/iredmail/iRedMail/archive/refs/tags/1.6.2.tar.gz
</span></span><span class=line><span class=cl>tar -xf iRedMail.tar.gz
</span></span><span class=line><span class=cl>cd iRedMail-1.4.2
</span></span><span class=line><span class=cl>bash iRedMail.sh
</span></span></code></pre></td></tr></table></div></div><p>Follow the setting instructions</p><p>Select database type to MariaDB</p><p>Set mail domain name <code>mydomain.com</code>instead of <code>mail.mydomain.com</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>***********************************************************************************</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Storgae</span> <span class=n>base</span> <span class=n>directory</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Mailboxes</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Daily</span> <span class=n>backup</span> <span class=n>of</span> <span class=n>SQL</span><span class=o>/</span><span class=n>LDAP</span> <span class=n>databases</span><span class=p>:</span>      <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>mail</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Store</span> <span class=n>mail</span> <span class=n>accounts</span> <span class=ow>in</span><span class=p>:</span>				   <span class=n>MariaDB</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Web</span> <span class=n>server</span><span class=p>:</span>                              <span class=n>Ngnix</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>First</span> <span class=n>mail</span> <span class=n>domain</span> <span class=n>name</span><span class=p>:</span>                  <span class=n>mydomain</span><span class=o>.</span><span class=n>com</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Mail</span> <span class=n>domain</span> <span class=n>admin</span><span class=p>:</span>                       <span class=n>postmaster</span><span class=err>@</span><span class=n>mydomain</span><span class=o>.</span><span class=n>com</span>
</span></span><span class=line><span class=cl><span class=o>*</span> <span class=n>Additional</span> <span class=n>components</span><span class=p>:</span>                   <span class=n>Rondcubenail</span> <span class=n>netdata</span> <span class=n>iRedAmin</span> <span class=n>Fail2ban</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span> <span class=n>Question</span> <span class=o>&gt;</span> <span class=n>Continue</span><span class=err>?</span> <span class=p>[</span><span class=n>y</span><span class=o>|</span><span class=n>N</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=get-ssl-cert><a href=#get-ssl-cert>#</a>
Get SSL cert</h2><p>Set DNS record</p><p><code>mail IN A</code></p><div class=table-wrapper><table><thead><tr><th>Type</th><th>Host</th><th>Value</th><th>Priority</th><th>TTL</th></tr></thead><tbody><tr><td>A</td><td>mail</td><td>Host IP address</td><td>NA</td><td>Auotomatic</td></tr></tbody></table></div><p>Check DNS recordhttps://www.boce.com/dns/https://dnschecker.org/</p><p>Use ACME scripts for SSL cert</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>curl</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>get</span><span class=o>.</span><span class=n>acme</span><span class=o>.</span><span class=n>sh</span> <span class=o>|</span> <span class=n>sh</span>
</span></span><span class=line><span class=cl><span class=c1>#Could be personal mail, or just use default xxxx@xxxx.com</span>
</span></span><span class=line><span class=cl><span class=o>~/.</span><span class=n>acme</span><span class=o>.</span><span class=n>sh</span><span class=o>/</span><span class=n>acme</span><span class=o>.</span><span class=n>sh</span> <span class=o>--</span><span class=n>register</span><span class=o>-</span><span class=n>account</span> <span class=o>-</span><span class=n>m</span> <span class=n>xxxx</span><span class=err>@</span><span class=n>xxxx</span><span class=o>.</span><span class=n>com</span>
</span></span><span class=line><span class=cl><span class=o>~/.</span><span class=n>acme</span><span class=o>.</span><span class=n>sh</span><span class=o>/</span><span class=n>acme</span><span class=o>.</span><span class=n>sh</span>  <span class=o>--</span><span class=n>issue</span> <span class=o>-</span><span class=n>d</span> <span class=n>mail</span><span class=o>.</span><span class=n>mydomain</span><span class=o>.</span><span class=n>com</span>  <span class=o>--</span><span class=n>webroot</span>  <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span>
</span></span></code></pre></td></tr></table></div></div><p>If timeout when CA processes and checks the domain,</p><p>switch to letsencrypt</p><p><code>./acme.sh --set-default-ca --server letsencrypt</code></p><p>Run</p><p><code>~/.acme.sh/acme.sh --issue -d mail.mydomain.com --webroot /var/www/html</code> again</p><p>Install the certification file to specific location</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#Works on Debian/Ubuntu, FreeBSD and OpenBSD
</span></span><span class=line><span class=cl>.acme.sh/acme.sh --installcert -d mail.mydomain.com --key-file /etc/ssl/private/iRedMail.key --fullchain-file /etc/ssl/certs/iRedMail.crt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#If RHEL/CentOS
</span></span><span class=line><span class=cl>./acme.sh --installcert -d mail.mydomain.com --key-file /etc/pki/tls/private/iRedMail.key --fullchain-file /etc/pki/tls/certs/iRedMail.crt
</span></span></code></pre></td></tr></table></div></div><p>Reload services</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>service</span> <span class=n>nginx</span> <span class=n>force</span><span class=o>-</span><span class=n>reload</span>
</span></span><span class=line><span class=cl><span class=n>service</span> <span class=n>postfix</span> <span class=n>reload</span>
</span></span><span class=line><span class=cl><span class=n>service</span> <span class=n>dovecot</span> <span class=n>reload</span>
</span></span></code></pre></td></tr></table></div></div><p>Remove greylist</p><p>edit <code>/opt/iredapd/settings.py</code></p><p>delet <code>greylisting</code> from</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>plugins = [&#34;reject_null_sender&#34;, &#34;wblist_rdns&#34;, &#34;reject_sender_login_mismatch&#34;, &#34;greylisting&#34;, &#34;throttle&#34;, &#34;amavisd_wblist&#34;, &#34;sql_alias_access_policy&#34;]
</span></span></code></pre></td></tr></table></div></div><p>then</p><p><code>service iredapd restart</code></p><h2 id=setting-up-dns-records><a href=#setting-up-dns-records>#</a>
Setting Up DNS Records</h2><h3 id=setting-ptr><a href=#setting-ptr>#</a>
Setting PTR</h3><h3 id=setting-mx-record><a href=#setting-mx-record>#</a>
Setting MX record</h3><p><code>IN MX mail.example.com</code></p><div class=table-wrapper><table><thead><tr><th>Type</th><th>Host</th><th>Value</th><th>Priority</th><th>TTL</th></tr></thead><tbody><tr><td>MX</td><td>@</td><td>mail.example.com</td><td>10</td><td>3600</td></tr></tbody></table></div><p>Get the config from <code>iRedMail.tips</code> file(inside the iRedMail Installer directory)</p><h3 id=setting-spf-record><a href=#setting-spf-record>#</a>
Setting SPF record</h3><blockquote><p>SPF or Sender Policy Framework is a DNS TXT record that is used to specify which IP addresses and/or servers are allowed to send email ‚Äúfrom‚Äù that particular domain. It is designed to detect forging sender addresses during the delivery of the email.</p></blockquote><p>add text record</p><p><code>v=spf1 a mx ip4:0.0.0.0 ~all</code></p><blockquote><ul><li>v=spf1 ‚Äì The version of SPF being used, this is the only version available</li><li>mx ‚Äì This means all hosts listed in the MX records are allowed to send emails for your domain and all other hosts are disallowed.</li><li>ip4:0.0.0.0 ‚Äì This is the IP address of the mail server or domain that is authorized to send email for that domain. Replace the IP in the example with your mail server‚Äôs public IP address.</li><li>~all ‚Äì The ‚Äúall‚Äù tag tells the receiving server how it should handle messages sent from a domain that is not listed in the SPF record. The tilde (~) with the ‚Äòa‚Äô is a soft fail, this would mark a server that is not listed in the SPF as spam, you can use -a for a flat out rejection.</li></ul></blockquote><h3 id=setting-dkim-records><a href=#setting-dkim-records>#</a>
Setting DKIM Records</h3><blockquote><p>DKIM or Domain Keys Identified Mail is an email authentication method that allows mail services to check that an email was indeed sent and authorized by the owner of that domain. In order to achieve this, you give the email a digital signature. This DKIM signature is a header that is added to the message and is secured with encryption.</p><p>The difference between DKIM and SPF is that DKIM is used to verify that the contents of the message are trustworthy. This is used to check that the email hasn‚Äôt been tampered with since the moment it left the initial mail server.</p></blockquote><h3 id=setting-dmarc-records><a href=#setting-dmarc-records>#</a>
Setting DMARC Records</h3><blockquote><p>DMARC or Domain-based Message Authentication Reporting and Conformance extends DKIM and SPF to determine the authenticity of an email message.</p><p>Most major email providers perform DMARC check by default before accepting the email. By performing these checks, the email provider knows what authentication methods should be present (SPF, DKIM, etc.) and reject messages that fail the checks as specified by the domain‚Äôs DMARC record.</p><p>Unlike SPF and DKIM that doesn‚Äôt provide reports on sources sending mails, you can get aggregated reports when DMARC is implemented.</p></blockquote><p><code>v=DMARC1; p=quarantine; pct=100; rua=mailto:dmarc-reports@mydomain.com</code></p><p>The above record states that any email which fails the authentication with the ‚ÄúFrom‚Äù domain is put it in the spam folder 100% of the time and activity is reported to the <a class=link href=mailto:dmarc-reports@mydomain.com>dmarc-reports@mydomain.com</a>. You can also flat out reject any email that fails the DMARC authentication by setting ‚Äòp=reject‚Äô.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>p=reject    #reject mails
</span></span><span class=line><span class=cl>p=none      #do nothing
</span></span><span class=line><span class=cl>p=quarantine  #flag as spam
</span></span></code></pre></td></tr></table></div></div><h3 id=check-status><a href=#check-status>#</a>
Check Status</h3><p>Check DNS record</p><p><a class=link href=https://dnschecker.org/ target=_blank rel=noopener>https://dnschecker.org/</a></p><p>Check DNS blacklist</p><p><a class=link href=https://www.boce.com/blacklist/ target=_blank rel=noopener>https://www.boce.com/blacklist/</a></p><p><a class=link href=https://www.dnsbl.info/ target=_blank rel=noopener>https://www.dnsbl.info/</a></p><p>Check DKIM</p><p><a class=link href=https://dmarcian.com/dkim-inspector/ target=_blank rel=noopener>https://dmarcian.com/dkim-inspector/</a>
<code>nslookup -type=txt dkim._domainkey.mydomain.com</code></p><p>Check DMARC</p><p><a class=link href=https://dmarcian.com/dmarc-inspector/ target=_blank rel=noopener>https://dmarcian.com/dmarc-inspector/</a></p><p>Check SPF</p><p><a class=link href=https://dmarcian.com/spf-survey/ target=_blank rel=noopener>https://dmarcian.com/spf-survey/</a></p><h2 id=access-email><a href=#access-email>#</a>
Access EMail</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>https://mail.mydomain.com/mail                 #mailbox entrance
</span></span><span class=line><span class=cl>https://mail.mydomain.com/netdata              # Server status monitor
</span></span><span class=line><span class=cl>https://mail.mydomain.com/iredadmin            # Admin panel
</span></span></code></pre></td></tr></table></div></div><p>Add new email user</p><p>Use third-party email clients</p><div class=table-wrapper><table><thead><tr><th>Protocol</th><th>address</th><th>ports & secured ports</th></tr></thead><tbody><tr><td>IAMP</td><td>mail.mydomain.com</td><td>143,993(SSl/TLS)</td></tr><tr><td>POP3</td><td>mail.mydomain.com</td><td>110,995</td></tr><tr><td>SMTP</td><td>mail.mydomain.com</td><td>25,587(STARLS),465(SSl/TLS)</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>* POP3 service: port 110 over STARTTLS (recommended), or port 995 with SSL.
</span></span><span class=line><span class=cl>* IMAP service: port 143 over STARTTLS (recommended), or port 993 with SSL.
</span></span><span class=line><span class=cl>* SMTP service: port 587 over STARTTLS.
</span></span><span class=line><span class=cl>  If you need to support old mail clients with SMTP over SSL (port 465),
</span></span><span class=line><span class=cl>  please check our tutorial: https://docs.iredmail.org/enable.smtps.html
</span></span><span class=line><span class=cl>* CalDAV and CardDAV server addresses: https://&lt;server&gt;/SOGo/dav/&lt;full email address&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>For more details, please check detailed documentations:
</span></span><span class=line><span class=cl>https://docs.iredmail.org/#mua
</span></span></code></pre></td></tr></table></div></div><h2 id=test-spammyness-of-emails><a href=#test-spammyness-of-emails>#</a>
Test Spammyness of Emails</h2><p><a class=link href=https://www.mail-tester.com/ target=_blank rel=noopener>https://www.mail-tester.com/</a></p><h2 id=fail2ban><a href=#fail2ban>#</a>
Fail2ban</h2><p>Default max tries is 5 times for postfix</p><p>Unban ip with fail2ban</p><h2 id=credits><a href=#credits>#</a>
Credits</h2><p><a class=link href=https://v2rayssr.com/iredmail.html target=_blank rel=noopener>https://v2rayssr.com/iredmail.html</a></p><p><a class=link href=https://upcloud.com/resources/tutorials/install-secure-private-email-server-modoboa target=_blank rel=noopener>https://upcloud.com/resources/tutorials/install-secure-private-email-server-modoboa</a></p></section><footer class=article-footer><section class=article-tags><a href=/tags/docker/>Docker</a>
<a href=/tags/self-host/>Self Host</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/setup-docker-and-portainer/><div class=article-details><h2 class=article-title>Setup Docker and Portainer</h2></div></a></article><article><a href=/p/self-hosting-a-kms-server/><div class=article-details><h2 class=article-title>Self Hosting A KMS Server</h2></div></a></article><article><a href=/p/setup-hugo-blog-and-gittalk/><div class=article-details><h2 class=article-title>Setup Hugo Blog and gittalk</h2></div></a></article><article><a href=/p/insurgency-sandstorm-%E5%BC%80%E6%9C%8D%E6%8C%87%E5%8D%97/><div class=article-details><h2 class=article-title>Insurgency Sandstorm ÂºÄÊúçÊåáÂçó</h2></div></a></article><article><a href=/p/basic-server-security-enforcing/><div class=article-details><h2 class=article-title>Basic Server Security Enforcing</h2></div></a></article></div></div></aside><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js></script><script src=https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js></script><script>const gitalk=new Gitalk({clientID:"a306dd938a54f8c2438c",clientSecret:"a65dc93963a3274daf6286f64dc96977549a77e3",repo:"YuiOfAstora.github.io",owner:"YuiOfAstora",admin:["YuiOfAstora"],distractionFreeMode:!1,id:md5(location.pathname)});(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("gitalk-container").innerHTML="Gitalk comments not available by default when the website is previewed locally.";return}gitalk.render("gitalk-container")})()</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2024 Yui's Blog</section><section class=powerby>@YuiOfAstora<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.25.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>